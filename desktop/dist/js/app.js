var app=angular.module("refeitorio",["templates","ui.router","angular-jwt","ngAnimate","ui.bootstrap","toaster"]);app.service("authInterceptor",["$q","$injector","$state",function($q,$injector,$state){this.responseError=function(response){return 401==response.status&&$state.current.name,$q.reject(response)}}]).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("authInterceptor"),$httpProvider.defaults.useXDomain=!0,delete $httpProvider.defaults.headers.common["If-Modified-Since"]}]),app.config(function($httpProvider,jwtOptionsProvider){jwtOptionsProvider.config({tokenGetter:function(options){return".html"==options.url.substr(options.url.length-5)?null:localStorage.getItem("id_token")},unauthenticatedRedirector:["$state",function($state){$state.go("Login")}],whiteListedDomains:["localhost"]}),$httpProvider.interceptors.push("jwtInterceptor")}),app.config(function($compileProvider){$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}),app.run(function($rootScope){$rootScope.userData={name:"",email:"",availableModules:"",bio:"",photo:""},$rootScope.vars={mealPrice:7.75},$rootScope.enviroments=[],$rootScope.selectedEnviroment={name:null,type:null,id:null},$rootScope.historyRecords=[]}),app.config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/Login"),$stateProvider.state("Login",{url:"/Login",templateUrl:"Login/Login.html",controller:"LoginController"}).state("Dashboard",{url:"/Dashboard",templateUrl:"Dashboard/Dashboard.html",controller:"DashboardController"}).state("Dashboard.Home",{url:"/Home",templateUrl:"Dashboard/Home/Home.html",controller:"HomeController"}).state("Dashboard.Nome",{url:"/Nome",templateUrl:"Dashboard/Verificacoes/Nome/Nome.html",controller:"NomeController"}).state("Dashboard.Subsidiado",{url:"/Subsidiado",templateUrl:"Dashboard/Verificacoes/Subsidiado/Subsidiado.html",controller:"HomeController"}).state("Dashboard.Dinheiro",{url:"/Dinheiro",templateUrl:"Dashboard/Verificacoes/Dinheiro/Dinheiro.html",controller:"HomeController"})}),angular.module("templates",[]),app.directive("headerBar",function(){return{restrict:"E",templateUrl:"directives/headerBar/headerBar.html",replace:!0,controller:["$scope","$rootScope","loginFactory","$state",function($scope,$rootScope,loginFactory,$state){$scope.logout=function(){loginFactory.logout().then(function(result){$state.go("Login")})}}]}}),app.directive("ngEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.ngEnter,{event:event})}),event.preventDefault())})}}),app.directive("personCard",function(){return{restrict:"E",templateUrl:"directives/personCard/personCard.html",replace:!0,scope:{person:"=person"},controller:["$scope","$rootScope","personsFactory","nameWeekday","historyFactory",function($scope,$rootScope,personsFactory,nameWeekday,historyFactory){$scope.$watch("person",function(){$scope.allowed=!1,$scope.notProcessed=!1,time=(new Date).getHours(),11<=time&&time<14&&($scope.person.lunch_pattern[nameWeekday.get()]&&($scope.allowed=!0),$scope.person.isBoarder&&($scope.allowed=!0)),18<=time&&time<21&&($scope.person.dinner_pattern[nameWeekday.get()]&&($scope.allowed=!0),$scope.person.isBoarder&&($scope.allowed=!0)),historyFactory.check($scope.person.id).then(function(result){result||($scope.conclict=!0),$scope.loaded=!0})}),$scope.register=function(){$scope.allowed&&($scope.allowed=!1,historyFactory.register($scope.person.id,"byEnviroment").then(function(result){result&&swal("Feito!","Aluno autorizado com sucesso.","success")}))},$scope.money=function(){$scope.notProcessed||($scope.notProcessed=!0,historyFactory.register($scope.person.id,"byPerson").then(function(result){result&&swal("Feito!","Pagamento processado com sucesso.","success")}))}}]}}),app.directive("sidebar",function(){return{restrict:"E",templateUrl:"directives/sidebar/sidebar.html",replace:!0,scope:{userData:"=userData"},controller:["$scope","$rootScope","personsFactory","nameWeekday","historyFactory",function($scope,$rootScope,personsFactory,nameWeekday,historyFactory){}]}}),app.factory("enviromentFactory",["$http","apiURL","$rootScope",function($http,apiURL,$rootScope){var enviromentFactory={},baseURL=apiURL.get()+"enviroment/";return enviromentFactory.getAll=function(){return $http.get(baseURL+"all").then(function(result){return $rootScope.enviroments=result.data,$rootScope.selectedEnviroment=result.data[0],!0},function(){return!1})},enviromentFactory.register=function(enviroment){return $http.post(baseURL+"register",enviroment).then(function(result){return enviromentFactory.getAll(),!0},function(){return!1})},enviromentFactory}]),app.factory("historyFactory",["$http","apiURL","$rootScope","$location",function($http,apiURL,$rootScope,$location){var historyFactory={},baseURL=apiURL.get()+"history/";return historyFactory.register=function(personID,paymentType){return $http.get(baseURL+"person/"+personID+"/"+paymentType+"/"+$rootScope.selectedEnviroment.id).then(function(result){return!0},function(result){return!1})},historyFactory.check=function(personID){return $http.get(baseURL+"check/person/"+personID).then(function(result){return!0},function(result){return!1})},historyFactory}]),app.factory("loginFactory",["$http","apiURL",function($http,apiURL){var loginFactory={},baseURL=apiURL.get()+"auth/";return loginFactory.login=function(email,password){return $http.post(baseURL+"login",{email:email,password:password}).then(function(result){return localStorage.setItem("id_token",result.data.data.token),!0},function(result){return!1})},loginFactory.logout=function(){return $http.delete(baseURL+"invalidate").then(function(result){return localStorage.removeItem("id_token"),!0},function(result){return localStorage.removeItem("id_token"),!0})},loginFactory}]),app.factory("personsFactory",["$http","apiURL","$rootScope",function($http,apiURL,$rootScope){var personsFactory={},baseURL=apiURL.get()+"person";return personsFactory.get=function(personID){return $http.get(baseURL+"/"+personID).then(function(result){return result.data},function(result){return!1})},personsFactory.getMany=function(quantity){return $http.get(baseURL+"/"+$rootScope.selectedEnviroment.id+"/get/"+quantity).then(function(result){return result.data},function(result){return!1})},personsFactory.searchPerson=function(searchTerm){return $http.get(baseURL+"/"+$rootScope.selectedEnviroment.id+"/search/"+searchTerm).then(function(result){return result.data},function(result){return!1})},personsFactory.addPerson=function(person){return $http.post(baseURL,person).then(function(result){return!0},function(result){return!1})},personsFactory}]),app.factory("reportFactory",["$http","apiURL","$rootScope",function($http,apiURL,$rootScope){apiURL.get();return{}}]),app.factory("userFactory",["$http","apiURL","$rootScope",function($http,apiURL,$rootScope){var userFactory={},baseURL=apiURL.get()+"auth/";return userFactory.loadData=function(){return $http.get(baseURL+"user").then(function(result){return 200!=result.status||$rootScope.userData.name||($rootScope.userData.name=result.data.data.name,$rootScope.userData.firstName=result.data.data.name.split(" ").slice(0,1).join(" "),$rootScope.userData.email=result.data.data.email,$rootScope.userData.availableModules={0:!0,1:!0,2:!0},$rootScope.userData.bio="",$rootScope.userData.photo="https://qualiscare.com/wp-content/uploads/2017/08/default-user.png"),!0},function(result){return!1})},userFactory.register=function(register){return $http.post(apiURL.get()+"register/user",register).then(function(result){if("success"==result.data)return!0},function(result){return!1})},userFactory}]),app.service("apiURL",["$location",function($location){this.get=function(){return"localhost"===$location.host()?$location.protocol()+"://"+$location.host()+"/refeitorio/webapp/backend/public/api/":"ngrok"===$location.host().split(".")[1]?$location.protocol()+"://"+$location.host()+"/refeitorio/webapp/backend/public/api/":"facepedidos"===$location.host().split(".")[1]?$location.protocol()+"://"+$location.host()+"/server/api/":"http://localhost/refeitorio/webapp/backend/public/api/"}}]),app.service("nameWeekday",function(){this.get=function(){switch((new Date).getDay()){case 0:day="sunday";break;case 1:day="monday";break;case 2:day="tuesday";break;case 3:day="wednesday";break;case 4:day="thursday";break;case 5:day="friday";break;case 6:day="saturday"}return day}}),app.controller("HomeController",["$scope",function($scope){}]),app.controller("NomeController",["$scope","$rootScope","personsFactory",function($scope,$rootScope,personsFactory){function updatePersons(){personsFactory.getMany(6).then(function(result){$rootScope.persons=result})}void 0!==$rootScope.persons&&null!==$rootScope.persons||updatePersons(),$scope.searchPerson=function(searchTerm){searchTerm?personsFactory.searchPerson(searchTerm).then(function(result){result?$scope.resultPersons=result:toaster.pop("error","Nada encontrado","Nenhum aluno encontrado")}):($scope.resultPersons=null,updatePersons())}}]),app.controller("HomeController",["$scope",function($scope){}]),app.controller("DashboardController",["$scope","$state","$rootScope","userFactory","reportFactory","personsFactory","enviromentFactory","historyFactory","jwtHelper",function($scope,$state,$rootScope,userFactory,reportFactory,personsFactory,enviromentFactory,historyFactory,jwtHelper){$rootScope.$on("mainLoading",function(evt,data){$scope.loaded=!0}),userFactory.loadData().then(function(result){result&&enviromentFactory.getAll().then(function(result){result&&$rootScope.$broadcast("mainLoading",!0)})}),$state.go("Dashboard.Home")}]),app.controller("LoginController",["$scope","$rootScope","loginFactory","userFactory","$state","$timeout","apiURL","toaster",function($scope,$rootScope,loginFactory,userFactory,$state,$timeout,apiURL,toaster){userFactory.loadData().then(function(result){result?$state.go("Dashboard"):$scope.loaded=!0}),$scope.login=function(){swal({title:"Por favor aguarde",text:"Verificando usuário...",onOpen:function(){swal.showLoading()}}),loginFactory.login($scope.email,$scope.password).then(function(result){swal.close(),result?($state.go("Dashboard"),toaster.pop("success","Sucesso","Logado com sucesso")):swal("Erro","Credenciais inválidas.","error")})}}]),app.controller("HomeController",["$scope",function($scope){}]),app.controller("HomeController",["$scope",function($scope){}]),angular.module("templates").run(["$templateCache",function($templateCache){$templateCache.put("Dashboard/Dashboard.html",'<section ng-cloak="" ng-if="loaded"><header-bar></header-bar><div class="mt-3"><div class="container-fluid"><div class="row"><sidebar class="ml-3"></sidebar><div class="col"><div class="jumbotron shadow p-3 mb-5 rounded"><ui-view></ui-view></div></div></div></div></div></section>'),$templateCache.put("Login/Login.html",'<div class="mt-5" ng-show="loaded"><div class="row"><div class="col-3"></div><div class="col-6"><div class="jumbotron"><h1 class="display-3">SIG Refeitório</h1><article><form class="login-form"><h3 class="text-center login-head"><i class="fa fa-lg fa-fw fa-user"></i>Login</h3><div class="form-group"><label class="control-label">Email</label><input class="form-control" ng-model="email" type="text" placeholder="Email" autofocus=""/></div><div class="form-group"><label class="control-label">Senha</label><input class="form-control" ng-model="password" type="password" placeholder="Senha"/></div><div class="form-group btn-container"><button class="btn btn-primary btn-block" ng-click="login()"><i class="fas fa-sign-in-alt mr-1"></i>Login</button></div></form></article></div></div></div></div>'),$templateCache.put("Dashboard/Home/Home.html",'<h1 class="display pull-left">- Início</h1><hr class="my-4"/><p class="lead">Utilize esta aplicação para verificar a entrada de alunos através de suas impressões digitais e/ou nome.</p>'),$templateCache.put("Dashboard/Registro/Home.html",'<h1 class="display pull-left">- Verificação Subsidiado</h1><hr class="my-4"/><br/><div class="text-center"><i style="font-size:133px;" class="material-icons">fingerprint</i></div><hr class="my-4"/><h3 class="text-center">Aguardando</h3><div class="bar"></div><br/><div class="text-center"><div class="alert alert-dismissible alert-success">\n<button type="button" class="close" data-dismiss="alert">&times;</button>\n<strong>Well done!</strong> You successfully read <a href="#" class="alert-link">this important alert message</a>.\n</div></div><div class="text-center"><div class="alert alert-dismissible alert-danger">\n<button type="button" class="close" data-dismiss="alert">&times;</button>\n<strong>Oh snap!</strong> <a href="#" class="alert-link">Change a few things up</a> and try submitting again.\n</div></div>'),$templateCache.put("Dashboard/Verificacoes/Dinheiro/Dinheiro.html",'<h1 class="display pull-left">- Verificação Subsidiado</h1><hr class="my-4"/><br/><div class="text-center"><i style="font-size:133px;" class="material-icons">fingerprint</i></div><hr class="my-4"/><h3 class="text-center">Aguardando</h3><div class="bar"></div><br/><div class="text-center"><div class="alert alert-dismissible alert-success">\n<button type="button" class="close" data-dismiss="alert">&times;</button>\n<strong>Well done!</strong> You successfully read <a href="#" class="alert-link">this important alert message</a>.\n</div></div><div class="text-center"><div class="alert alert-dismissible alert-danger">\n<button type="button" class="close" data-dismiss="alert">&times;</button>\n<strong>Oh snap!</strong> <a href="#" class="alert-link">Change a few things up</a> and try submitting again.\n</div></div>'),$templateCache.put("Dashboard/Verificacoes/Nome/Nome.html",'<h1 class="display pull-left">- Verificação via Nome</h1><hr class="my-4"/><br/><div class="row mb-3"><div class="col"><h2 class="mb-3 line-head">{{(selectedEnviroment.type == \'school\') ? \'Alunos\':\'Funcionários\'}}</h2><div class="form-row align-items-center"><div class="col"><input class="form-control mb-2" type="text" placeholder="Pesquisar..." ng-model="searchTerm" ng-enter="searchPerson(searchTerm)"/></div><div class="col-auto" style="border-right: 1px solid #333;"><button class="btn btn-primary mb-2" ng-click="searchPerson(searchTerm)">Pesquisar</button></div></div><p class="text-muted">Últimos 6 {{(selectedEnviroment.type == \'school\') ? \'alunos\':\'funcionários\'}} cadastrados no sistema</p></div></div><div class="container"><div class="row"><div class="col d-flex align-items-stretch"><div class="card-columns" ng-if="!resultPersons"><person-card ng-repeat="person in persons" person="person"></person-card></div><div class="card-columns" ng-if="resultPersons.length &gt; 0"><person-card ng-repeat="person in resultPersons" person="person"></person-card></div></div></div></div>'),$templateCache.put("Dashboard/Verificacoes/Subsidiado/Subsidiado.html",'<h1 class="display pull-left">- Verificação Subsidiado</h1><hr class="my-4"/><br/><div class="text-center"><i style="font-size:133px;" class="material-icons">fingerprint</i></div><hr class="my-4"/><h3 class="text-center">Aguardando</h3><div class="bar"></div><br/><div class="text-center"><div class="alert alert-dismissible alert-success">\n<button type="button" class="close" data-dismiss="alert">&times;</button>\n<strong>Well done!</strong> You successfully read <a href="#" class="alert-link">this important alert message</a>.\n</div></div><div class="text-center"><div class="alert alert-dismissible alert-danger">\n<button type="button" class="close" data-dismiss="alert">&times;</button>\n<strong>Oh snap!</strong> <a href="#" class="alert-link">Change a few things up</a> and try submitting again.\n</div></div>'),$templateCache.put("directives/headerBar/headerBar.html",'<header><nav class="navbar navbar-expand-lg navbar-light bg-light"><a class="navbar-brand" href="#">SIG Refeit&oacute;rio</a><a class="navbar-brand" href="#">- {{selectedEnviroment.name}}</a><div style="position: absolute; right: 25px;"><div class="btn-group mr-2" uib-dropdown="" dropdown-append-to-body=""><button class="btn btn-outline-success" type="button" uib-dropdown-toggle="">{{selectedEnviroment.name}}<span class="caret"></span></button><div class="dropdown-menu" uib-dropdown-menu="" role="menu" aria-labelledby="btn-append-to-body"><a class="dropdown-item" ng-repeat="enviroment in enviroments" href="javascript:void(0)">{{enviroment.name}}</a></div></div><button class="btn btn-danger" ng-click="logout()">Logout   </button></div></nav></header>'),$templateCache.put("directives/personCard/personCard.html",'<div class="card"><img class="card-img-top" ng-src="./img/icone.png" alt="Card image cap"/><div class="card-body"><h4>{{person.name}}</h4></div><hr class="m-0"/><div class="card-body"><div class="row" ng-if="loaded">{{(conclict || notProcessed)}}<div class="col-6 text-center"><a href=\'javascript:void(0)\' class="btn btn-lg" ng-class="{\'btn-primary\': allowed, \'btn-secondary\': (conflict || !allowed)}" ng-click="register()" ng-disabled=\'(conflict || !allowed)\'>Autorizar</a></div><div class="col-6 text-center"><a href=\'javascript:void(0)\' class="btn btn-lg" ng-class="{\'btn-success\': !notProcessed, \'btn-secondary\': (conclict || notProcessed)}" ng-click="money()" ng-disabled=\'(conclict || notProcessed)\'>Dinheiro</a></div></div></div></div>'),$templateCache.put("directives/sidebar/sidebar.html",'<div class="col-sm-3 col-md-2 sidebar-offcanvas bg-light shadow p-3 mb-5 rounded" role="navigation"><p>Menu</p><ul class="nav nav-pills flex-column"><li class="nav-item"><a class="nav-link" href="javascript:void(0)" ui-sref-active="active" ui-sref="Dashboard.Home"> <i class="mr-2 fa fa-home"></i>Início</a></li></ul><hr/><p>Verificações</p><ul class="nav nav-pills flex-column"><li class="nav-item"><a class="nav-link" href="javascript:void(0)" ui-sref-active="active" ui-sref="Dashboard.Subsidiado"> <i class="mr-2 fa fa-graduation-cap"></i>Subsidiado</a></li><li class="nav-item"><a class="nav-link" href="javascript:void(0)" ui-sref-active="active" ui-sref="Dashboard.Dinheiro"><i class="mr-2 fa fa-money"></i>Dinheiro</a></li><li class="nav-item"><a class="nav-link" href="javascript:void(0)" ui-sref-active="active" ui-sref="Dashboard.Nome"> <i class="mr-2 fa fa-address-card"></i>Nome</a></li></ul><hr/><p>Registrar Digital</p><ul class="nav nav-pills flex-column"><li class="nav-item"><a class="nav-link" href="javascript:void(0)" ui-sref-active="active" ui-sref="Dashboard.Test"> <i class="mr-2 fa fa-search"></i>Pesquisar...</a></li></ul></div>')}]);