var app=angular.module("refeitorio",["templates","ui.router","ngAnimate","ngDialog","toaster","bw.paging"]);app.config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/Login"),$stateProvider.state("Login",{url:"/Login",templateUrl:"Login/Login.html",controller:"LoginController"}).state("Dashboard",{url:"/Dashboard",templateUrl:"Dashboard/Dashboard.html",controller:"DashboardController"}).state("Dashboard.Home",{url:"/Home",templateUrl:"Dashboard/Home/Home.html",controller:"HomeController"})}),app.service("authInterceptor",["$q","$injector","$state",function($q,$injector,$state){this.responseError=function(response){if(401==response.status&&"Login"!=$state.current.name){var ngDialog=$injector.get("ngDialog");localStorage.removeItem("id_token"),ngDialog.closeAll(),swal({title:"Faça login",text:"Você deve estar logado para ver esta página",type:"error",confirmButtonText:"Ok"}).then(function(){$state.go("Login")},function(dismiss){$state.go("Login")})}return $q.reject(response)}}]).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("authInterceptor"),$httpProvider.defaults.useXDomain=!0,delete $httpProvider.defaults.headers.common["If-Modified-Since"]}]),app.config(["$httpProvider",function($httpProvider){localStorage.getItem("id_token")&&($httpProvider.defaults.headers.common.Authorization="Bearer "+localStorage.getItem("id_token"))}]),app.run(function($rootScope){$rootScope.userData={name:"",email:"",availableModules:"",bio:"",photo:""},$rootScope.vars={mealPrice:7.75},$rootScope.enviroments="",$rootScope.selectedEnviroment={name:"Campus Teste",type:"school",id:1}}),angular.module("templates",[]),app.directive("notificationMenu",function(){return{restrict:"E",templateUrl:"directives/notificationMenu/notificationMenu.html",replace:!0,controller:["$scope","$rootScope",function($scope,$rootScope){$scope.alert=function(){alert("test")}}]}}),app.directive("personCard",function(ngDialog){return{restrict:"E",templateUrl:"directives/personCard/personCard.html",replace:!0,scope:{person:"=person"},controller:["$scope","$rootScope","ngDialog","toaster","personsFactory","nameWeekday","historyFactory",function($scope,$rootScope,ngDialog,toaster,personsFactory,nameWeekday,historyFactory){$scope.$watch("person",function(){$scope.allowed=!1,$scope.processed=!1,time=(new Date).getHours(),console.log("entrou"),11<time&&time<14&&(console.log("tempo certo: "+time),$scope.person.lunch_pattern[nameWeekday.get()]&&($scope.allowed=!0,console.log("via sala")),$scope.person.isBoarder&&($scope.allowed=!0,console.log("via interno"))),19<time&&time<21&&(console.log("tempo certo: "+time),$scope.person.dinner_pattern[nameWeekday.get()]&&($scope.allowed=!0,console.log("via sala")),$scope.person.isBoarder&&($scope.allowed=!0,console.log("via interno")))}),$scope.register=function(){$scope.allowed&&($scope.allowed=!1,historyFactory.register($scope.person.id,"byEnviroment",$rootScope.selectedEnviroment.id).then(function(result){result&&swal("Feito!","Aluno autorizado com sucesso.","success")}))},$scope.money=function(){$scope.processed||($scope.processed=!0,historyFactory.register($scope.person.id,"byPerson",$rootScope.selectedEnviroment.id).then(function(result){result&&swal("Feito!","Pagamento processado com sucesso.","success")}))}}]}}),app.directive("sidebar",function(){return{restrict:"E",templateUrl:"directives/sidebar/sidebar.html",replace:!0,scope:{user:"=user"},controller:["$scope","$rootScope","$timeout",function($scope,$rootScope,$timeout){$timeout(function(){$scope.loaded=!0},1500),$scope.sideBar=[{name:"Início",route:"Dashboard.Home",icon:"fa-home"}]}]}}),app.directive("userButton",function(){return{restrict:"E",templateUrl:"directives/userButton/userButton.html",replace:!0,controller:["$scope","$state","loginFactory","toaster",function($scope,$state,loginFactory,toaster){$scope.logout=function(){loginFactory.logout().then(function(result){toaster.pop("success","Deslogado",""),$state.go("Login")})}}]}}),app.factory("enviromentFactory",["$http","apiURL","$rootScope",function($http,apiURL,$rootScope){var enviromentFactory={},baseURL=apiURL.get()+"enviroment/";return enviromentFactory.getAll=function(){return $http.get(baseURL+"all").then(function(result){return $rootScope.enviroments=result.data,!0},function(){return!1})},enviromentFactory}]),app.factory("historyFactory",["$http","apiURL",function($http,apiURL){var historyFactory={},baseURL=apiURL.get()+"history/";return historyFactory.register=function(personID,paymentType,enviromentID){return $http.get(baseURL+"person/"+personID+"/"+paymentType+"/"+enviromentID).then(function(result){return!0},function(result){return!1})},historyFactory}]),app.factory("loginFactory",["$http","apiURL",function($http,apiURL){var loginFactory={},baseURL=apiURL.get()+"auth/";return loginFactory.login=function(email,password){return localStorage.removeItem("id_token"),$http.post(baseURL+"login",{email:email,password:password}).then(function(result){return localStorage.setItem("id_token",result.data.data.token),$http.defaults.headers.common.Authorization="Bearer "+result.data.data.token,!0},function(result){return!1})},loginFactory.logout=function(){return $http.delete(baseURL+"invalidate").then(function(result){return localStorage.removeItem("id_token"),!0},function(result){return localStorage.removeItem("id_token"),!0})},loginFactory}]),app.factory("personsFactory",["$http","apiURL","$rootScope","toaster",function($http,apiURL,$rootScope,toaster){var personsFactory={},baseURL=apiURL.get()+"person";return personsFactory.get=function(personID){return $http.get(baseURL+"/"+personID).then(function(result){return result.data},function(result){return!1})},personsFactory.searchPerson=function(searchTerm){return $http.get(baseURL+"/"+$rootScope.selectedEnviroment.id+"/search/"+searchTerm).then(function(result){return result.data},function(result){return!1})},personsFactory}]),app.factory("userFactory",["$http","apiURL","$rootScope",function($http,apiURL,$rootScope){var userFactory={},baseURL=apiURL.get()+"auth/";return userFactory.loadData=function(){return $http.get(baseURL+"user").then(function(result){return 200!=result.status||$rootScope.userData.name||($rootScope.userData.name=result.data.data.name,$rootScope.userData.firstName=result.data.data.name.split(" ").slice(0,1).join(" "),$rootScope.userData.email=result.data.data.email,$rootScope.userData.availableModules={0:!0,1:!0,2:!0,3:!1,4:!1,5:!0},$rootScope.userData.bio="Programador Ninja",$rootScope.userData.photo="https://s3.amazonaws.com/uifaces/faces/twitter/jsa/48.jpg"),!0},function(result){return!1})},userFactory}]),app.service("apiURL",["$location",function($location){this.get=function(){return"localhost"===$location.host()?$location.protocol()+"://"+$location.host()+"/refeitorio/webapp/backend/public/api/":"ngrok"===$location.host().split(".")[1]?$location.protocol()+"://"+$location.host()+"/refeitorio/webapp/backend/public/api/":"http://sae.facepedidos.com.br/server/api/"}}]),app.service("nameWeekday",function(){this.get=function(){switch((new Date).getDay()){case 0:day="sunday";break;case 1:day="monday";break;case 2:day="tuesday";break;case 3:day="wednesday";break;case 4:day="thursday";break;case 5:day="friday";break;case 6:day="saturday"}return day}}),app.controller("DashboardController",["$scope","$state","$rootScope","userFactory","toaster","enviromentFactory",function($scope,$state,$rootScope,userFactory,toaster,enviromentFactory){userFactory.loadData().then(function(result){result?enviromentFactory.getAll().then(function(result){result?($scope.loaded=!0,console.log($rootScope.enviroments)):toaster.pop("error","Falha","Falha ao coletar dados, verifique sua conexão ou tente novamente mais tarde")}):toaster.pop("error","Falha","Falha ao coletar dados, verifique sua conexão ou tente novamente mais tarde")}),$scope.sidebarToggle=function(){angular.element(document.querySelector("#body")).toggleClass("sidenav-toggled")},$state.go("Dashboard.Home")}]),app.controller("LoginController",["$scope","$rootScope","loginFactory","userFactory","toaster","$state","$timeout","apiURL",function($scope,$rootScope,loginFactory,userFactory,toaster,$state,$timeout,apiURL){userFactory.loadData().then(function(result){result?$state.go("Dashboard"):$scope.loaded=!0}),$scope.login=function(){loginFactory.login($scope.email,$scope.password).then(function(result){result?(toaster.pop("success","Logado","Logou com sucesso"),$state.go("Dashboard")):toaster.pop("error","Falha","Falha na autenticação")})}}]),app.controller("HomeController",["$scope","personsFactory","toaster","$location",function($scope,personsFactory,toaster,$location){$scope.loaded=!0,$scope.scan=function(){$scope.loaded=!1,"localhost"===$location.host()?personsFactory.get(1).then(function(result){result?($scope.loaded=!0,$scope.person=result):toaster.pop("error","Falha ao verificar pessoa","verifique a conexão")}):cordova.plugins.barcodeScanner.scan(function(result){result.cancelled||"QR_CODE"!=result.format||personsFactory.get(result.text).then(function(result){result?($scope.loaded=!0,$scope.person=result):toaster.pop("error","Falha ao verificar pessoa","verifique a conexão")})},function(error){alert("Scanning failed: "+error)})}}]),angular.module("templates").run(["$templateCache",function($templateCache){$templateCache.put("Dashboard/Dashboard.html",'<header class="app-header"><a class="app-header__logo" href="javascript:void(0)">SIG Refeitório</a><ul class="app-nav"><notification-menu></notification-menu><user-button></user-button></ul></header><div class="app-sidebar__overlay" data-toggle="sidebar">   </div><sidebar user="userData"></sidebar><div class="row mt-5" ng-hide="loaded"><div class="col-12"><div class="loading-bro"><svg id="load" x="0px" y="0px" viewbox="0 0 150 150"><circle id="loading-inner" cx="75" cy="75" r="60"></circle></svg></div></div></div><div ng-cloak="" ng-show="loaded"><main class="app-content"><ui-view></ui-view></main></div>'),$templateCache.put("Login/Login.html",'<div ng-show="loaded"><section class="material-half-bg"><div class="cover araquari-fachada"></div></section><section class="login-content"><div class="logo"><h1> </h1></div><div class="login-box" ng-class="{\'flipped\': flip}"><form class="login-form"><h3 class="login-head"><i class="fa fa-lg fa-fw fa-user"></i>SIG Refeitório</h3><div class="form-group"><label class="control-label">Email</label><input class="form-control" ng-model="email" type="text" placeholder="Email" autofocus=""/></div><div class="form-group"><label class="control-label">Senha</label><input class="form-control" ng-model="password" type="password" placeholder="Senha"/></div><div class="form-group"><div class="utility"><p class="semibold-text mb-2 text-center"><a href="javascript:void(0)" ng-click="flip = !flip">Esqueceu a senha?</a></p></div></div><div class="form-group btn-container"><button class="btn btn-primary btn-block" ng-click="login()"><i class="fas fa-sign-in-alt mr-1"></i>Login</button></div></form><form class="forget-form"><h3 class="login-head"><i class="fa fa-lg fa-fw fa-lock"></i>Esqueceu a senha?</h3><div class="form-group"><label class="control-label">Email</label><input class="form-control" type="text" placeholder="Email"/></div><div class="form-group btn-container"><button class="btn btn-primary btn-block"><i class="fa fa-unlock fa-lg fa-fw"></i>RECUPERAR</button></div><div class="form-group mt-3"><p class="semibold-text mb-0"><a href="javascript:void(0)" ng-click="flip = !flip"><i class="fa fa-angle-left fa-fw"></i> Voltar</a></p></div></form></div></section></div>'),$templateCache.put("Dashboard/Home/Home.html",'<div class="app-title"><div><h1><i class="fa fa-tachometer-alt"></i> Scan</h1><p>Essa tela contém dados do último aluno scaneado.</p></div></div><div class="row"><div class="col-md-6 col-lg-3 text-center mt-1 mb-2"><button class="btn btn-primary btn-lg" type="button" ng-click="scan()">Escanear aluno</button></div></div><div class="row mt-5" ng-hide="loaded"><div class="col-12"><div class="loading-bro"><svg id="load" x="0px" y="0px" viewbox="0 0 150 150"><circle id="loading-inner" cx="75" cy="75" r="60"></circle></svg></div></div></div><div ng-cloak="" ng-show="loaded"><div class="row"><div class="col-md-6 col-lg-3"><person-card person="person" ng-if="person"></person-card></div></div></div>'),$templateCache.put("directives/notificationMenu/notificationMenu.html",'<li class="dropdown" ng-class="{\'show\':enviromentsActive}"><a class="app-nav__item" data-toggle="dropdown" aria-label="Open Profile Menu" ng-click="enviromentsActive=!enviromentsActive"><i class="fa fa-angle-down fa-lg"></i></a><ul class="app-notification dropdown-menu dropdown-menu-right" ng-class="{\'show\':enviromentsActive}"><li class="app-notification__title">Ambientes</li><li class="row" ng-repeat="enviroment in enviroments"><div class="col-1"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x text-primary"></i><i class="fa fa-stack-1x fa-inverse" ng-class="{\'fa-university\': (enviroment.type == \'school\')}"></i></span></div><div class="col-3"></div><div class="mt-2">{{enviroment.name}}</div><div class="col-1"></div><div class="col-1"><i class="mt-2 fas fa-pencil-alt fa-stack-1x" ng-click="alert()"></i></div><div class="col-1"><i class="mt-2 fas fa-trash-alt fa-stack-1x" ng-click="alert()"></i></div></li><li class="app-notification__footer"><a href="javascript:void(0)"></a></li></ul></li>'),$templateCache.put("directives/personCard/personCard.html",'<div class="card"><img class="card-img-top" ng-src="./img/icone.png" alt="Card image cap"/><div class="card-body"><h5 class="card-title">{{person.name}}</h5></div><hr class="m-0"/><div class="card-body"><a href=\'javascript:void(0)\' class="btn btn-lg pull-left" ng-class="{\'btn-primary\': allowed, \'btn-secondary\': !allowed}" ng-click="register()" ng-disabled=\'!allowed\'>Autorizar</a>\n<a href=\'javascript:void(0)\' class="btn btn-lg pull-right" ng-class="{\'btn-success\': !processed, \'btn-secondary\': processed}" ng-click="money()" ng-disabled=\'processed\'>Dinheiro</a></div></div>'),$templateCache.put("directives/sidebar/sidebar.html",'<aside class="app-sidebar"><section ng-cloak=""><article ng-hide="user.name &amp;&amp; loaded"><div class="item"><div class="animated-bg"><div class="mask header-top"></div><div class="mask header-left"></div><div class="mask header-right"></div><div class="mask header-bottom"></div><div class="mask subheader-left"></div><div class="mask subheader-right"></div><div class="mask subheader-bottom"></div><div class="mask content-top"></div><div class="mask content-first-end"></div><div class="mask content-second-line"></div><div class="mask content-second-end"></div><div class="mask content-third-line"></div><div class="mask content-third-end"> </div></div></div></article><article ng-show="user.name &amp;&amp; loaded"><div class="app-sidebar__user"><img class="app-sidebar__user-avatar" ng-src="{{user.photo}}" alt="User Image" heigth="50" width="50"/><div><p class="app-sidebar__user-name">{{user.firstName}}</p><p class="app-sidebar__user-designation">{{user.bio}}</p></div></div><ul class="app-menu"><li ng-repeat="module in sideBar" ng-class="{\'treeview\': module.isTree, \'is-expanded\': active}" ng-click="active=!active &amp;&amp; user.availableModules[$index]"><a class="app-menu__item" ui-sref-active="active" ui-sref="{{module.route}}" ng-if="!module.isTree" ng-class="{\'text-muted disabled\': !user.availableModules[$index]}" ng-disabled="!user.availableModules[$index]"><i class="app-menu__icon fa {{module.icon}}"></i><span class="app-menu__label row"><div class="col-sm-8">{{module.name}}                </div><div class="col-sm-4 mt-1"><div class="badge badge-secondary float-right" ng-if="!user.availableModules[$index]">Indisponível</div></div></span></a></li></ul></article></section></aside>'),$templateCache.put("directives/userButton/userButton.html",'<li class="dropdown" ng-class="{\'show\':userButtonActive}"><a class="app-nav__item" data-toggle="dropdown" aria-label="Open Profile Menu" ng-click="userButtonActive=!userButtonActive"><i class="fa fa-user fa-lg"></i></a><ul class="dropdown-menu settings-menu dropdown-menu-right" ng-class="{\'show\':userButtonActive}"><li><a class="dropdown-item" href="javascript:void(0)" ng-click="logout()"><i class="fas fa-sign-out-alt fa-lg"></i> Logout</a></li></ul></li>')}]);